<!DOCTYPE HTML>
<html>
	<head>
		<title>Sign Up</title>

		<style type="text/css">
			input {
				display: block;
			}
		</style>
		<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	</head>
	<body>
		<span id="message"></span>
		<form action="/user/" method="post">
			<input type="text" name="first_name" placeholder="John" />
			<input type="text" name="last_name" placeholder="Wayne" />
			<input type="text" name="email" placeholder="hello@domain.com" />
			<input type="submit" value="Register" />
		</form>
		<script>
			var validationErrorMessageDivs = new Array()

			$( "form" ).submit(function( event ) {
				$('#message').html('')
				for(var i  = 0; i < validationErrorMessageDivs.length; i++){
					$(validationErrorMessageDivs[i]).remove()
				}

				var formData = {};
				$(this).serializeArray().map(function(x){formData[x.name] = x.value;}); 

				$.ajax({
					method:'POST',
					url: $(this).attr('action'),
					cache:false,
					data: JSON.stringify(formData)

				})
				.done(function(data, textStatus, jqXHR){
				 	$('#message').text('Thanks for signing up! Check your inbox for your verification email so you can get started using TREC today')
				})
				.fail(function(jqXHR, textStatus, errorThrown ){
				 	$('#message').text('There were some issues with information you provided')
				 	var data = $.parseJSON(jqXHR.responseText) 
				 	
				 	for(var i = 0; i < data.errors.length; i++){
				 		var validationError = data.errors[i]
				 		var input = $('input[name=' + validationError.field_name + ']').before('<div style="color:red">' + validationError.error_message + '</div>')
				 		validationErrorMessageDivs.push(input.prev())
				 		input.css('border-color','red')
				 	}
				});
			 
				event.preventDefault();
			});
		</script>		

	</body>
</html>